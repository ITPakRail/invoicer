<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Client</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&display=swap');
        
        :root { --primary: #2c3e50; --accent: #3498db; --success: #27ae60; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 20px; margin: 0; transition: all 0.3s; }
        
        /* RTL & Urdu Styles */
        body.rtl-mode { direction: rtl; font-family: 'Noto Nastaliq Urdu', serif; }
        body.rtl-mode .card { text-align: right; }
        body.rtl-mode input, body.rtl-mode textarea { text-align: right; font-family: 'Noto Nastaliq Urdu', serif; }

        .card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
        h2 { color: var(--primary); margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; font-size: 14px; outline: none; }
        input:focus { border-color: var(--accent); }
        textarea { resize: vertical; height: 80px; }
        .btn-save { width: 100%; padding: 12px; background: var(--success); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        .btn-save:hover { background: #219150; }
        .btn-save:disabled { background: #95a5a6; cursor: not-allowed; }
        #status-msg { margin-top: 15px; text-align: center; font-size: 14px; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2 data-key="title">ðŸ‘¤ Add New Client</h2>
    
    <div class="form-group">
        <label data-key="lblClient">Client Name *</label>
        <input type="text" id="clientName" class="urdu-input" placeholder="Enter client or business name" data-placeholder="pClient">
    </div>

    <div class="form-group">
        <label data-key="lblPhone">Phone Number *</label>
        <input type="text" id="phone" placeholder="e.g. +923001234567" data-placeholder="pPhone">
    </div>

    <div class="form-group">
        <label data-key="lblEmail">Email Address</label>
        <input type="email" id="email" placeholder="client@example.com" data-placeholder="pEmail">
    </div>

    <div class="form-group">
        <label data-key="lblAddress">Address</label>
        <textarea id="address" class="urdu-input" placeholder="Enter physical or billing address" data-placeholder="pAddress"></textarea>
    </div>

    <button id="saveBtn" class="btn-save" onclick="saveClient()" data-key="btnSave">Save Client</button>
    
    <div id="status-msg"></div>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwpyyuTtbSv_2udttbXog8oUfq_vgFvr-y7DggVO-WXYkR4APnpB_0BS6TpSZLdnBrN/exec";

    const i18n = {
        en: {
            title: "ðŸ‘¤ Add New Client", lblClient: "Client Name *", lblPhone: "Phone Number *",
            lblEmail: "Email Address", lblAddress: "Address", btnSave: "Save Client",
            pClient: "Enter client or business name", pPhone: "e.g. +923001234567",
            pEmail: "client@example.com", pAddress: "Enter physical or billing address",
            saving: "Saving...", success: "âœ… Client added successfully!", error: "âŒ Network Error.",
            alertFields: "Client Name and Phone are required."
        },
        ur: {
            title: "ðŸ‘¤ Ù†ÛŒØ§ Ú©Ù„Ø§Ø¦Ù†Ù¹ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº", lblClient: "Ú©Ù„Ø§Ø¦Ù†Ù¹ Ú©Ø§ Ù†Ø§Ù… *", lblPhone: "ÙÙˆÙ† Ù†Ù…Ø¨Ø± *",
            lblEmail: "Ø§ÛŒ Ù…ÛŒÙ„ Ø§ÛŒÚˆØ±ÛŒØ³", lblAddress: "Ù¾ØªÛ", btnSave: "Ú©Ù„Ø§Ø¦Ù†Ù¹ Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº",
            pClient: "Ú©Ù„Ø§Ø¦Ù†Ù¹ ÛŒØ§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± Ú©Ø§ Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº", pPhone: "Ù…Ø«Ù„Ø§Ù‹ 923001234567",
            pEmail: "client@example.com", pAddress: "Ú©Ù„Ø§Ø¦Ù†Ù¹ Ú©Ø§ Ù¾ØªÛ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº",
            saving: "Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ø±ÛØ§ ÛÛ’...", success: "âœ… Ú©Ù„Ø§Ø¦Ù†Ù¹ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯ÛŒØ§!", error: "âŒ Ù†ÛŒÙ¹ ÙˆØ±Ú© Ú©ÛŒ Ø®Ø±Ø§Ø¨ÛŒÛ”",
            alertFields: "Ú©Ù„Ø§Ø¦Ù†Ù¹ Ú©Ø§ Ù†Ø§Ù… Ø§ÙˆØ± ÙÙˆÙ† Ù†Ù…Ø¨Ø± Ø¶Ø±ÙˆØ±ÛŒ ÛÛ’Û”"
        }
    };

    // Phonetic Keyboard Mapping
    const urduMap = {
        'a': 'Ø§', 'b': 'Ø¨', 'c': 'Ú†', 'd': 'Ø¯', 'e': 'Ø¹', 'f': 'Ù', 'g': 'Ú¯', 'h': 'Û', 'i': 'ÛŒ', 'j': 'Ø¬',
        'k': 'Ú©', 'l': 'Ù„', 'm': 'Ù…', 'n': 'Ù†', 'o': 'Û', 'p': 'Ù¾', 'q': 'Ù‚', 'r': 'Ø±', 's': 'Ø³', 't': 'Øª',
        'u': 'Ùˆ', 'v': 'Ø·', 'w': 'Ùˆ', 'x': 'Ø´', 'y': 'Û’', 'z': 'Ø²', 'A': 'Ø¢', 'S': 'Øµ', 'D': 'Úˆ', 'T': 'Ù¹'
    };

    function applyLanguage() {
        const lang = localStorage.getItem("dashboardLang") || "en";
        const t = i18n[lang];
        
        document.querySelectorAll('[data-key]').forEach(el => {
            const key = el.getAttribute('data-key');
            if (t[key]) el.innerText = t[key];
        });

        document.querySelectorAll('[data-placeholder]').forEach(el => {
            const key = el.getAttribute('data-placeholder');
            if (t[key]) el.placeholder = t[key];
        });

        if (lang === 'ur') {
            document.body.classList.add('rtl-mode');
        } else {
            document.body.classList.remove('rtl-mode');
        }
    }

    // Urdu Typing Logic
    document.addEventListener('keypress', (e) => {
        const lang = localStorage.getItem("dashboardLang") || "en";
        if (lang === 'ur' && e.target.classList.contains('urdu-input')) {
            if (urduMap[e.key]) {
                e.preventDefault();
                const start = e.target.selectionStart;
                const end = e.target.selectionEnd;
                const text = e.target.value;
                e.target.value = text.substring(0, start) + urduMap[e.key] + text.substring(end);
                e.target.selectionStart = e.target.selectionEnd = start + 1;
            }
        }
    });

    window.onload = applyLanguage;

    async function saveClient() {
        const lang = localStorage.getItem("dashboardLang") || "en";
        const t = i18n[lang];
        
        const name = document.getElementById("clientName").value.trim();
        const phone = document.getElementById("phone").value.trim();
        const email = document.getElementById("email").value.trim();
        const address = document.getElementById("address").value.trim();
        const statusMsg = document.getElementById("status-msg");
        const saveBtn = document.getElementById("saveBtn");

        if (!name || !phone) {
            alert(t.alertFields);
            return;
        }

        const user = JSON.parse(localStorage.getItem("user"));
        if (!user || !user.sheetId) return alert("Session expired.");

        saveBtn.disabled = true;
        saveBtn.innerText = t.saving;
        statusMsg.innerText = "";

        const payload = {
            action: "saveClient",
            sheetId: user.sheetId,
            userId: user.id,
            clientId: "CLI-" + Math.floor(Math.random() * 9000 + 1000),
            clientName: name,
            phone: phone,
            email: email,
            address: address,
            dateAdded: new Date().toLocaleDateString()
        };

        try {
            await fetch(API_URL, {
                method: "POST",
                mode: "no-cors",
                body: JSON.stringify(payload)
            });

            statusMsg.style.color = "green";
            statusMsg.innerText = t.success;
            
            document.querySelectorAll('input, textarea').forEach(el => el.value = "");

        } catch (err) {
            statusMsg.style.color = "red";
            statusMsg.innerText = t.error;
        } finally {
            saveBtn.disabled = false;
            saveBtn.innerText = t.btnSave;
        }
    }
</script>

</body>
</html>
